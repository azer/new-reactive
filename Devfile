task 'test', 'index.js', 'lib', 'test', ->
    exec 'fox -b -i test/template.js'

target 'test/template.js', 'test/template.html', ->
    cd 'test'
    write 'template.js', html2js(cat 'template.html')

html2js = (html) ->
    output = 'module.exports = "'
    output += html.replace(/\"/g, '\\"').replace /\n/g, ' '
    output += '";'
